[TOC]

# 数据库

* MySQL
* Oracle

## 1、数据库优化

优化分为4大部分：

* 1、硬件和操作系统层面

  硬件层面：CPU、可用内存大小、磁盘读写速度、网络带宽

  操作系统层面：应用文件句柄数、操作系统网络配置

  在硬件基础资源的优化中，我们重点应该关注服务本身承载的体量，然后提出合理的指标要求，避免出现资源浪费。

* 2、架构设计层面的优化

  MySQL是一个磁盘IO访问量非常频繁的关系型数据库，架构设计层面有几部分可以优化

  * ①搭建MySQL主从集群，单个MySQL服务容易单点故障，一旦服务器宕机，将会导致依赖MySQL数据库的应用全部无法响应。主从集群或者主主机群可以保证服务的高可用性。
  * ②读写分离设计。在读多写少的场景中，通过读写分离的方案，可以避免读写冲突导致的性能影响。
  * ③引入分库分表机制，通过分库可以降低单个服务器节点的IO压力，通过分表的方式可以降低单表数据量，从而提升SQL查询的效率。
  * ④热点数据，引入Redis、MongoDB等更高效的分布式数据库，他们可以很好的缓解MySQL的访问压力，同时还可以提升数据检索性能。

* 3、MySQL程序配置优化

  可以通过配置`my.cnf`来完成。

  比如：MySQL5.7版本默认最大连接数是151个；binlog日志默认不开启

* 4、SQL优化

  SQL优化分为三部曲：

  * ①慢SQL定位和排查

    可以开启慢SQL记录，然后分析

  * ②执行计划

    使用`explain` 查看SQL执行计划

  * ③索引

    * SQL查询尽量是基于索引来进行数据扫描
    * 避免索引列上使用函数或者运算，这样会导致索引失效
    * `where`子句中 `like %`，尽量保证最左匹配原则
    * 使用索引扫描，联合索引中的列从左往右，命中越多越好
    * 尽可能使用SQL语句用到的索引完成排序
    * 查询有效的列星系即可。少用 `*` 代替列信息
    * 永远小结果集驱动大结果集。

## 2、MySQL索引

### 2.1、索引的使用

索引（Index）是MySQL重要的性能优化手段，它能够提高数据查询的速度，类似于书籍的目录。合理使用索引可以显著提升查询效率，但不合理的索引可能会影响性能（如增加存储开销和降低插入、更新、删除操作的速度）。

索引是一种用于提高数据库查询效率的数据结构，MySQL的索引是基于B+树或哈希表实现的。

### 2.2、联合索引

* 作用：对多个列创建索引，提高组合查询的效率。

* 注意：遵循 `最左前缀匹配原则`，即查询条件必须包含索引的最左侧列。

* 创建方式：

  * ```sql
    CREATE INDEX idx_name_age ON user(name, age);
    ```

* 使用方式：

  * `WHERE name='TOM' AND age=25`  能使用索引
  * `WHERE name='TOM'`  能使用索引
  * `WHERE age=25`  无法使用索引（未匹配最左前缀）

### 2.3、覆盖索引

* 只使用索引就能完成查询，避免回表。

* 例子：

  * ```sql
    CREATE INDEX idx_name_age ON user(name, age);
    ```

  * ```sql
    SELECT name, age FROM user WHERE name='Tom'; -- 只查询索引字段，无需回表
    ```

  * 

### 2.4、使用合适的索引类型

* 频繁查询可使用 普通索引；
* 需要唯一性约束时使用 唯一索引；
* 搜索大文本时使用 全文索引；

### 2.5、索引失效

* 使用`LIKE 'keyword'`
* 在索引列上使用函数
* 在索引列上进行计算
* `OR`查询未对所有条件加索引
* `!=` `<>`和`NOT IN` 导致索引失效

### 2.6、回表问题

根据索引找到Id，再根据Id找到数据

## 3、事务

### 3.1、基本要数

MySQL事务基本要素有ACID四个特性，即：

* 1、原子性（Atomicity）：
* 2、一致性（Consistency）：
* 3、隔离性（Isolation）：
* 4、持久性（Durabilit）：

其中，原子性he持久性保证了数据的安全性，一致性保证了数据的准确性，隔离性保证了数据的独立性。

### 3.2、隔离级别

数据库隔离级别指的是多个事务同时执行时，各自所处的隔离程度。常见的隔离级别有四种：

* 1、读未提交（Read Uncommitted）：一个事务可以读取另一个未提交事务的数据，这种隔离级别可能导致脏读、不可重复读、幻读等问题。
* 2、读已提交（Read Commited）：一个事务只能读取已经提交的事物的数据，可以避免脏读问题，但是会出现不可重复读和幻读问题。
* 3、可重复读（Repeatable Read）：在一个事务中多次读取同一个数据返回的结果是相同的。避免了不可重复读问题，但是仍然可能出现幻读问题。
* 4、序列化（Serializable）:最高的隔离级别，所有事务按照串行方式执行，避免了所有并发问题，但是效率低下

在实际开发中，一般会根据具体业务需求选择适当的隔离级别。需要注意的是，隔离级别越高，对数据库的性能影响越大。